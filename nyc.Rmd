---
title: "nyc"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(dplyr)
library(janitor)
library(skimr)
library(infer)
```

```{r}
# Read in main data set

data <- read.csv("raw/schma19962016.csv") %>% 
  clean_names()

addon <- read_csv("raw/stchso20052016.csv") %>% 
  clean_names()

# Create a list of schools so that I can see how they are named in this data

schools <- data %>% 
  select(schnam) %>% 
  distinct(schnam) %>% 
  arrange(schnam)

# Create a list of NYC's specialized schools

selective_schools_list <- c("BRONX HIGH SCHOOL OF SCIENCE", "BROOKLYN TECHNICAL HIGH SCHOOL", "STATEN ISLAND TECHNICAL HS", "STUYVESANT HIGH SCHOOL", "BROOKLYN LATIN, THE", "QUEENS HIGH SCHOOL FOR THE SCIENCES AT YORK COLLEG", "HIGH SCHOOL FOR MATHEMATICS, SCIENCE AND ENGINEERI", "HIGH SCHOOL OF AMERICAN STUDIES AT LEHMAN COLLEGE")

# Create a dataset that filters out observations for selective schools

selective_schools <- data %>% 
  filter(schnam %in% selective_schools_list)

```

```{r Graduation Rates Cutoff Comparison}

# Filter for high schools (defined as schools serving 9-12 at least)  

data_hs <- data %>% 
  filter(enrnumg12 != 0 & enrnumg11 != 0 & enrnumg10  != 0 & enrnumg09 != 0 
         & !is.na(hsopcthsgtot)) %>% 
  select(schnam, year, hsopcthsgtot) %>% 
  group_by(year) %>% 
  mutate(percent_rank = percent_rank(hsopcthsgtot))

# Plot all schools by year and graduation rates

data_hs %>% 
  filter(hsopcthsgtot != is.na(hsopcthsgtot)) %>% 
  select(schnam, year, hsopcthsgtot) %>% 
  ggplot(aes(x = year, y = hsopcthsgtot, color = schnam)) + 
  geom_jitter() +
  theme(legend.position = "none")

# Plot percentile rank of school over time

data_hs %>% 
  filter(schnam %in% selective_schools_list) %>% 
  ggplot(aes(x= year, y = percent_rank, color = schnam)) +
  geom_line() +
  theme(legend.position = "none")

# Find out valid observations of graduation rates per year

data %>% 
  group_by(year) %>% 
  filter(hsopctdchtot != is.na(hsopcthsgtot)) %>% 
  select(schnam, year, hsopcthsgtot) %>% 
  count()

# Filter for observations with percentage graduation numbers

#data_1 <- data %>% 
 # filter(hsopctdchtot != is.na(hsopcthsgtot)) %>% 
  #select(schnam, year, hsopcthsgtot, enrnumg12) %>% 
  #group_by(schnam) %>%
  #nest() 

#data_2 <- data_1 %>% 
  #mutate(schools_below_45 = map(data, ~ifelse(.[[1]] == 2005 & .[[2]] <= 55,
   #                                           schnam,
    #                                          0
     #                                         )),
      #   yes_no = ifelse(any(0 == schools_below_45),
        #                 TRUE,
       #                  FALSE))

#data_3 <- data_1 %>% 
 # mutate(schools_below_45 = ifelse(any(2005 == data[[1]]) & 
   #                                any(data[[2]] <= 55),
  #                                 as.character(schnam),
  #                                  "a"
   #                               ))

```






